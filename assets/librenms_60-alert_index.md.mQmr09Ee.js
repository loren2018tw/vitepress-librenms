import{_ as s,o as a,c as e,R as t}from"./chunks/framework.Rav5NEMf.js";const i="/vitepress-librenms/assets/2023-12-22-13-59-45.qVo-v-6i.png",n="/vitepress-librenms/assets/2023-12-22-14-13-03.EF6Ta_c5.png",p="/vitepress-librenms/assets/2023-12-22-16-16-05.6WgpUN1Q.png",l="/vitepress-librenms/assets/2023-12-22-16-17-52.aIoyBtTV.png",r="/vitepress-librenms/assets/2023-12-22-16-18-40.flPfbBUH.png",o="/vitepress-librenms/assets/2023-12-22-16-21-06.TT7Tm2o5.png",c="/vitepress-librenms/assets/2023-12-22-16-35-20._KDaOvyb.png",h="/vitepress-librenms/assets/2023-12-22-16-34-55.XpZ4rPsG.png",m="/vitepress-librenms/assets/2023-12-22-16-42-38.v0fIDpag.png",g="/vitepress-librenms/assets/2023-12-22-17-03-46.q5sbeo4D.png",d="/vitepress-librenms/assets/2023-12-22-21-22-40.LSGrLOHU.png",x=JSON.parse('{"title":"警報","description":"","frontmatter":{},"headers":[],"relativePath":"librenms/60-alert/index.md","filePath":"librenms/60-alert/index.md"}'),b={name:"librenms/60-alert/index.md"},k=t('<h1 id="警報" tabindex="-1">警報 <a class="header-anchor" href="#警報" aria-label="Permalink to &quot;警報&quot;">​</a></h1><p>裝置離線或是溫度過高， LibrenNMS 可以發出警報提醒，除了顯示警報在 LireNms 界面外，還可以使用多種通知方式 ex: mail、sms、telegram 通知網管，以下將介紹使用 telergam 來傳送警報訊息</p><h2 id="telegram-安裝及中文化" tabindex="-1">telegram 安裝及中文化 <a class="header-anchor" href="#telegram-安裝及中文化" aria-label="Permalink to &quot;telegram 安裝及中文化&quot;">​</a></h2><p>可先參考以下網頁，安裝 telegram <a href="https://www.pkstep.com/archives/13832" target="_blank" rel="noreferrer">telegram 安裝及中文化</a></p><h2 id="申請-telegram-bot" tabindex="-1">申請 telegram bot <a class="header-anchor" href="#申請-telegram-bot" aria-label="Permalink to &quot;申請 telegram bot&quot;">​</a></h2><p>在 telergram 搜尋 @botfather 這個帳號，然後點入跟這個機器人聊天 <img src="'+i+'" alt=""></p><p>在聊天室打上依序打上地下的內容，就可以取得機器人的 token，請記住這個資訊 <img src="'+n+'" alt=""></p><p>接著在瀏覽器打上，將&lt;你的token&gt;替換成前面取到的 token</p><p><a href="https://api.telegram.org/bot%3C%E4%BD%A0%E7%9A%84token%3E/getUpdates" target="_blank" rel="noreferrer">https://api.telegram.org/bot&lt;你的token&gt;/getUpdates</a></p><p>我們需要的就是回傳資料裡面的聊天室id(chat id)</p><p><img src="'+p+'" alt=""></p><h2 id="建立-librenms-警報傳送器" tabindex="-1">建立 librenms 警報傳送器 <a class="header-anchor" href="#建立-librenms-警報傳送器" aria-label="Permalink to &quot;建立 librenms 警報傳送器&quot;">​</a></h2><ol><li></li></ol><p><img src="'+l+'" alt=""> 2. <img src="'+r+'" alt=""> 3. 傳送器類型選擇：telegram。 填入前面取得的 chat id 跟 token，格式可以選擇 HTML 也可以順便設定為預設的傳送器 <img src="'+o+'" alt=""></p><h2 id="建立警報規則" tabindex="-1">建立警報規則 <a class="header-anchor" href="#建立警報規則" aria-label="Permalink to &quot;建立警報規則&quot;">​</a></h2><ol><li><p>執行主選單【選單/警報規則】 <img src="'+c+'" alt=""></p></li><li><p>中間有個按鈕，點下去就會建立很多預設的規則，有興趣可以直接建立，然後觀看學習。 Librenms 也收集很多規則可以套用，所以手動建立規則也很方便 <img src="'+h+'" alt=""></p></li><li><p>以下使用 Create rule from collection 手動建立，按下 Create rule from collection 按鈕，裡面有收集很多規則，我們選擇 Devices up/down ，當裝置離線時，就會產生警報 <img src="'+m+'" alt=""> 設定警報條件 <img src="'+g+`" alt=""></p></li></ol><h2 id="警報範本" tabindex="-1">警報範本 <a class="header-anchor" href="#警報範本" aria-label="Permalink to &quot;警報範本&quot;">​</a></h2><p>有傳送器，有規則，最後還要有警報範本（要傳送的警報內容），這三項缺一不可。 官方說明有提供範本內容，依據不同規則，我們需要知道的資訊不一樣，所以才需要不同範本。例如裝置斷線我們只需要知道是哪台主機跟位置，硬碟容量使用過高，我們會想要知道硬碟空間使用多少、剩餘多少...等。 也可以所有規則都套用一個警報範本，只是這樣警報的內容可就會太複雜或是缺少需要的資訊。 <a href="https://docs.librenms.org/Alerting/Templates/" target="_blank" rel="noreferrer">https://docs.librenms.org/Alerting/Templates/</a></p><p>底下是一個純文字的警報範本</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>{{ $alert-&gt;title }}</span></span>
<span class="line"><span>嚴重性: {{ $alert-&gt;severity }}</span></span>
<span class="line"><span>@if ($alert-&gt;state == 0) 經過時間: {{ $alert-&gt;elapsed }} @endif</span></span>
<span class="line"><span>警報時間: {{ $alert-&gt;timestamp }} Unique-ID: {{ $alert-&gt;uid }} </span></span>
<span class="line"><span>硬體：{{ $alert-&gt;hardware }}</span></span>
<span class="line"><span>位置：{{ $alert-&gt;location }}</span></span>
<span class="line"><span>@if ($alert-&gt;faults)</span></span>
<span class="line"><span>故障:</span></span>
<span class="line"><span>@foreach ($alert-&gt;faults as $key =&gt; $value)</span></span>
<span class="line"><span>  #{{ $key }}: {{ $value[&#39;string&#39;] }}</span></span>
<span class="line"><span>@endforeach</span></span>
<span class="line"><span>@endif</span></span></code></pre></div><p><img src="`+d+'" alt=""></p><p>接著就等待警報發生吧! &gt;&lt; (聽起來怎麼怪怪的！！)</p><h2 id="修正時區" tabindex="-1">修正時區 <a class="header-anchor" href="#修正時區" aria-label="Permalink to &quot;修正時區&quot;">​</a></h2><p>收到警報訊息會發現上面的時間不對， librenms 時區是使用 php 的環境設定，所以要修改 php 的設定檔，執行</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/php/8.1/fpm/php.ini</span></span></code></pre></div><p>找到 date.timezone 設定，將他修改成</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>date.timezone = &quot;Asia/Taipei&quot;</span></span></code></pre></div><p>然後重啟 php</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> php8.1-fpm.service</span></span></code></pre></div>',29),_=[k];function u(v,f,y,C,F,q){return a(),e("div",null,_)}const T=s(b,[["render",u]]);export{x as __pageData,T as default};
